!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class n{constructor(t,e,i){this.data=t,this.hiliteStart=t.hiliteStart,this.hiliteLength=t.hiliteLength,this.referenceBox=e,this.description=i,this.id=(new Date).getTime(),this.container=document.createElement("div"),this.container.setAttribute("class","infoBox"),this.getExtraction(t.extract),this.addToDom(),this.addListeners()}getExtraction(t){const e=`\n            <p class="infoBoxRow">${this.description}</p>\n        `,i=`\n            <p class="codeLine" id="${this.id}">${this.escapeChars(t)}</p>\n        `;this.container.innerHTML=e,this.container.innerHTML+=i}escapeChars(t){return t.replace(/<(?=\S|$)/g,"&lt;").replace(/>(?=\S|$)/g,"&gt;").replace(/\n/g,"↩").replace(/ /g,"&nbsp;")}addToDom(){document.body.appendChild(this.container);let t=this.referenceBox.getBoundingClientRect();this.container.style.top=t.top+"px",this.container.style.left=t.left<300?"300px":t.left-this.container.getBoundingClientRect().width+"px",this.hilite()}hilite(){const t=document.getElementById(this.id),e=t.innerText,i=e.slice(0,this.data.hiliteStart),n=e.slice(this.data.hiliteStart,this.hiliteStart+this.data.hiliteLength),s=e.slice(this.data.hiliteStart+this.data.hiliteLength,e.length);t.innerHTML=this.replaceChars(i)+"<span class='validator-hilite'>"+this.replaceChars(n)+"</span>"+this.replaceChars(s)}replaceChars(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp")}remove(){window.removeEventListener("resize",this.updatePosition),this.container.parentNode.removeChild(this.container)}addListeners(){window.addEventListener("resize",t=>this.updatePosition())}updatePosition(){let t=this.referenceBox.getBoundingClientRect();this.container.style.top=t.top+"px",this.container.style.left=t.left-this.container.getBoundingClientRect().width+"px"}}class s{constructor(t,e,i){this.data=t,this.domNode=e,this.domNodeName=e.nodeName,this.id=i,this.showPointerInfoBox=!1,this.showInfoBox=!1,this.description="",this.handleGoToBoxClick=this.handleGoToBoxClick.bind(this),this.toggleInfoBox=this.toggleInfoBox.bind(this),this.getDescription(),this.createElements(),this.createErrorBox(),this.createErrorMessages(),this.addListeners()}createElements(){this.box=document.createElement("div"),this.box.setAttribute("class","listItem"),this.title=document.createElement("h4"),this.message=document.createElement("p"),this.rowInfo=document.createElement("p"),this.rowInfo.setAttribute("class","validator__rowinfo"),this.goToBox=document.createElement("div"),this.goToBox.innerHTML="&#11176;",this.goToBox.setAttribute("class","goToBox")}createErrorBox(){let t="info"==this.data.type?"warning":"error";this.box.classList.add(t)}createErrorMessages(){let t=this.data.subType?this.data.subType:this.data.type;this.title.innerHTML=t,this.rowInfo.innerHTML=this.description,this.message.innerText=this.data.message.replace(/\r?\n|\r/g,"↩"),this.box.appendChild(this.title),console.log("SCRIPT"===this.domNodeName),void 0!==this.domNode?(console.log("Inside with type "+this.domNodeName),this.checkIfVisibleNode()?this.box.appendChild(this.goToBox):this.goToBox=null):this.goToBox=null,this.box.appendChild(this.rowInfo),this.box.appendChild(this.message)}getDescription(){this.data.firstColumn?this.description=`From line ${this.data.firstLine?this.data.firstLine:this.data.lastLine}, column ${this.data.firstColumn}, to line ${this.data.lastLine}, column ${this.data.lastColumn}.`:this.description=`At line ${this.data.lastLine}, column ${this.data.lastColumn}.`}handleGoToBoxClick(t){t.stopPropagation(),this.domNode.scrollIntoView({behavior:"smooth"})}removeGoToBox(t){t.parentNode.removeChild(t)}toggleInfoBox(t){t.stopPropagation(),this.showInfoBox?this.remove():(this.showInfoBox=!0,this.infoBox=new n(this.data,this.box,this.description))}remove(){this.showInfoBox&&(this.infoBox.remove(),this.showInfoBox=!1)}addListeners(){null!=this.domNode&&this.checkIfVisibleNode()&&(this.goToBox.addEventListener("mouseenter",t=>{this.initialStyle=t.target.style,this.domNode.style.border="3px solid red",this.domNode.style.boxSizing="border-box"}),this.goToBox.addEventListener("mouseleave",t=>{this.domNode.style=this.initialStyle}),this.goToBox.addEventListener("click",this.handleGoToBoxClick)),this.rowInfo.addEventListener("click",this.toggleInfoBox)}checkIfVisibleNode(){switch(this.domNodeName){case"SCRIPT":case"HEAD":case"BASE":case"LINK":case"META":case"STYLE":case"TITLE":return!1;default:return!0}}}class o{constructor(t,e,i,n){this.jsonData=t,this.htmlArr=e,this.comments=i,this.callback=n,this.listItems=[],this.deltaY=null,this.createElements(),this.createListItems(),this.addListeners()}createElements(){this.parentSquare=document.getElementById("parentSquare"),this.menu=document.createElement("div");const t=this.jsonData.messages.map(t=>t.subType?t.subType:t.type),e=this.numberOfErrors(t),i=`\n            <span class="validator__warning-icon"></span>\n            <span class="validator__warningText">Warnings:&nbsp;</span>\n            ${e.warnings}\n            <span class="validator__error-icon"></span>\n            <span class="validator__warningText">&nbsp;Errors:&nbsp;</span>\n            ${e.errors}\n            <span class="validator__smallIcon"></span>\n            `;this.menu.innerHTML=i,this.menu.setAttribute("id","validationListMenuBar"),this.menuContent=document.createElement("span"),this.menuContent.setAttribute("class","extendedBtn extended"),this.menuContent.innerHTML="&#171;",this.menu.appendChild(this.menuContent),this.listContainer=document.createElement("div"),this.listContainer.setAttribute("class","validatorListContainer validatorListContainer--expanded"),this.parentSquare.appendChild(this.menu),this.parentSquare.appendChild(this.listContainer),document.body.appendChild(this.parentSquare),this.checkIfExpanded()}checkIfExpanded(){JSON.parse(window.localStorage.getItem("rawHTMLExpanded")).expanded||this.toggleExpansion()}numberOfErrors(t){let e={warnings:0,errors:0};return t.map(t=>"warning"===t?e.warnings++:e.errors++),e}createListItems(){const t=/\r?\n|\r/g;for(let e=0;e<this.jsonData.messages.length;e++){let i=this.jsonData.messages[e],n=i.lastLine-1,o=(this.htmlArr[n].split("↵")[0],i.firstColumn),a=(i.extract.split(t),this.getElem(o,n)),r=new s(i,a,e);this.listItems.push(r),this.listContainer.appendChild(r.box)}}getElem(t,e){const i=this.htmlArr[e],n=i.substring(t,i.length),s=n.substring(0,n.indexOf(">")).split(" ")[0],o=i.substring(0,t);let a=this.findOccurances(s.toLowerCase(),o,e);for(let t=e-1;t>=0;t--){let e=this.htmlArr[t];a+=this.findOccurances(s.toLowerCase(),e,t)}return document.getElementsByTagName(s)[a]}findOccurances(t,e,i){const n=`<${t}>`;let s=0;for(let t=0;t<e.length;t++){e.substring(t,t+n.length).toLowerCase()!=n||this.betweenComments(t,i)||s++}return s}betweenComments(t,e){let i=!1;return this.comments.map(n=>{e>=n.startLineIndex&&e<=n.endLineIndex&&t>=n.startPos&&t<=n.endPos&&(i=!0)}),i}addListeners(){this.parentSquare.addEventListener("scroll",t=>this.listItems.map(t=>t.remove())),this.menu.addEventListener("click",t=>{this.toggleExpansion()})}toggleExpansion(){this.changeClassNames(),this.listItems.map(t=>t.remove());const t=this.listContainer.classList.contains("validatorListContainer--expanded"),{x:e,y:i}=this.parentSquare.getBoundingClientRect();window.localStorage.setItem("rawHTMLExpanded",JSON.stringify({expanded:t})),t?(this.deltaY=i,this.callback(e,i)):this.callback(e,this.deltaY)}changeClassNames(){this.parentSquare.classList.toggle("validator--disable-scroll"),this.listContainer.classList.toggle("validatorListContainer--expanded"),this.menuContent.classList.toggle("extended"),document.getElementsByClassName("validator__warning-icon")[0].classList.toggle("validator__inline-block"),document.getElementsByClassName("validator__error-icon")[0].classList.toggle("validator__inline-block"),document.getElementsByClassName("validator__warningText")[0].classList.toggle("validator__warning--hide"),document.getElementsByClassName("validator__warningText")[1].classList.toggle("validator__warning--hide"),document.getElementsByClassName("validator__smallIcon")[0].classList.toggle("validator__inline-block")}}class a{constructor(){this.container=document.createElement("div"),this.container.setAttribute("class","rawHTMLContainer"),this.container.setAttribute("draggable","true"),this.deltaX=null,this.deltaY=null,document.body.appendChild(this.container),this.loadCss(),this.bindMethods(),this.setInitPosition(),this.checkBrowser()}bindMethods(){this.getDom=this.getDOM.bind(this),this.dragStart=this.dragStart.bind(this),this.dragoverBody=this.dragoverBody.bind(this),this.updatePosition=this.updatePosition.bind(this),this.endDrag=this.endDrag.bind(this)}setInitPosition(){const t=JSON.parse(window.localStorage.getItem("htmlValidatorPosition"));null===t?this.setNewPosition(0,0):this.setNewPosition(t.x,t.y)}loadCss(){var t=document.createElement("link");t.href="ValidationStyleSheet.css",t.type="text/css",t.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(t)}checkIfOnline(){navigator.onLine?this.createInitBox():this.createOfflineBox()}createInitBox(){this.container.addEventListener("dragstart",this.dragStart),this.container.innerHTML='\n        <div class="rawHTMLContainer--init">\n            <img src="./src/img/rawhtml_icon.png" alt="Raw Validator image" />\n            <button id="rawHTMLContainer__button">Validate</button>\n        </div>\n        ',document.getElementById("rawHTMLContainer__button").addEventListener("click",t=>{console.log("click"),this.container.innerHTML="",this.getDOM()})}createOfflineBox(){this.container.innerHTML='\n        <div class="validator--center validator--lightTheme">\n            <h4>You are offline</h4>\n            <p>You need an internet connection to run RAWHtml validator.</p>\n        </div>\n        '}checkBrowser(){const t=this.getBrowser(),e=window.location.href;"Chrome"!==t||-1===e.indexOf("file://")&&0!=e.indexOf("/")?this.checkIfOnline():this.container.innerHTML=`\n            <div class="validator--lightTheme validator--center">\n                <h4>Oops..</h4>\n                <p>It seems you are using ${t} without using a local webserver.</p><p> Need help? Go <a href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/set_up_a_local_testing_server"><strong>here!</strong></a></p>\n            </div>\n        `}getBrowser(){let t,e,i=navigator.userAgent,n=navigator.appName;return-1!=(e=i.indexOf("OPR/"))?n="Opera":-1!=(e=i.indexOf("Opera"))?n="Opera":-1!=(e=i.indexOf("MSIE"))?n="Microsoft Internet Explorer":-1!=(e=i.indexOf("Chrome"))?n="Chrome":-1!=(e=i.indexOf("Safari"))?n="Safari":-1!=(e=i.indexOf("Firefox"))?n="Firefox":(t=i.lastIndexOf(" ")+1)<(e=i.lastIndexOf("/"))&&(n=i.substring(t,e)).toLowerCase()==n.toUpperCase()&&(n=navigator.appName),n}printErrorMessage(t){this.container.innerHTML=`\n            <div class="validator--lightTheme validator--center">\n                <h4>Oops..</h4>\n                <p>Could not find anyone with username ${t}</p>\n            </div>\n        `}getDOM(){window.localStorage.getItem("rawHTMLExpanded")||window.localStorage.setItem("rawHTMLExpanded",JSON.stringify({expanded:!0})),this.container.setAttribute("id","parentSquare");const t=document.createElement("div");t.setAttribute("class","validator--loading"),this.container.appendChild(t),fetch(document.location).then(t=>t.text()).then(t=>this.getFetch(t))}getFetch(t){const e=this.getLineBreak(t),i=this.getComments(e);let n=new FormData;n.append("out","json"),n.append("content",t),fetch("https://html5.validator.nu/",{method:"POST",body:n,header:{"Content-type":"text/html; charset=utf-8"}}).then(t=>t.json()).then(t=>{this.container.removeChild(document.getElementsByClassName("validator--loading")[0]),new o(t,e,i,this.extractCoors.bind(this))}).catch(t=>console.log(t))}getLineBreak(t){return t.split(/\r?\n|\r/g)}getComments(t){let e=[];for(let i=0;i<t.length;i++)if(-1!=t[i].indexOf("\x3c!--")){let n={startLineIndex:i,startPos:t[i].indexOf("\x3c!--")};for(let s=i;s<t.length;s++)if(-1!=t[s].indexOf("--\x3e")){n.endLineIndex=s,n.endPos=t[s].indexOf("--\x3e"),e.push(n);break}}return e}dragStart(t){this.emptyImage=document.createElement("img"),this.emptyImage.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",t.dataTransfer.setDragImage(this.emptyImage,0,0),t.dataTransfer.setData("text/plain",null);const e=this.container.getBoundingClientRect();this.deltaX=t.clientX-e.left,this.deltaY=t.clientY-e.top,this.createDragUi(),document.body.addEventListener("dragover",this.dragoverBody),this.container.addEventListener("dragend",this.endDrag)}createDragUi(){this.overlay=document.createElement("div"),this.overlay.setAttribute("class","validator-dark-overlay"),document.body.appendChild(this.overlay)}dragoverBody(t){this.updatePosition(t.clientX,t.clientY)}updatePosition(t,e){this.container.style.top=e-this.deltaY+3+"px",this.container.style.left=t-this.deltaX+"px"}endDrag(t){t.preventDefault(),document.body.removeEventListener("dragover",this.dragoverBody),this.container.removeEventListener("dragend",this.endDrag),this.emptyImage=null;const e=parseInt(this.container.style.left),i=parseInt(this.container.style.top);this.extractCoors(e,i),this.removeElements()}extractCoors(t,e){const i=e<0?0:e+this.container.clientHeight>window.innerHeight?window.innerHeight-this.container.clientHeight:e;this.setNewPosition(t,i)}removeElements(){document.body.removeChild(this.overlay)}setNewPosition(t,e){this.container.style.top=e+"px",t>window.innerWidth/2?(this.container.style.left="",this.container.style.right="0px"):(this.container.style.right="",this.container.style.left="0px"),window.localStorage.setItem("htmlValidatorPosition",JSON.stringify({x:t,y:e}))}setRightPosition(){this.container.style.left="",this.container.style.right="0px",window.localStorage.setItem("htmlValidatorPosition","right")}setLeftPosition(){this.container.style.left="0px",this.container.style.right="",window.localStorage.setItem("htmlValidatorPosition","left")}}window.addEventListener("load",function t(){window.removeEventListener("load",t),new a},!1)}]);